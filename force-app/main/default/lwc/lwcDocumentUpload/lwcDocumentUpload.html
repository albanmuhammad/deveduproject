<template>
    <lightning-card title="Account Documents">
        <div class="slds-p-around_small">
            <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                <thead>
                    <tr>
                        <th>Document Type</th>
                        <th>Status</th>
                        <th>Uploaded File</th>
                        <th>Document Link</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <template for:each={decoratedDocuments} for:item="doc">
                        <tr key={doc.value}>
                            <td>{doc.label}</td>
                            <td>
                                <span class={doc.statusClass}>{doc.statusLabel}</span>
                            </td>

                            <!-- Upload cell -->
                            <td>
                                <!-- When not disabled, show the real uploader -->
                                <template if:false={doc.uploadDisabled}>
                                    <lightning-file-upload
                                        name={doc.value}
                                        record-id={uploadParentId}
                                        label="Upload"
                                        accept={acceptedFormats}
                                        onuploadfinished={handleUploadFinished}>
                                    </lightning-file-upload>
                                </template>

                                <!-- When disabled (e.g., Verified), show a disabled lookalike -->
                                <template if:true={doc.uploadDisabled}>
                                    <lightning-button label="Upload Files" disabled></lightning-button>
                                </template>
                            </td>

                            <td>
                                <template if:true={doc.documentLink}>
                                    <a href={doc.documentLink} target="_blank" rel="noopener">Open</a>
                                </template>
                                <template if:false={doc.documentLink}>
                                    <span class="slds-text-color_weak">â€”</span>
                                </template>
                            </td>

                            <td class="actions-cell">
                                <div class="action-buttons">
                                    <template if:false={doc.hideVerify}>
                                        <lightning-button
                                            class="slds-m-right_small"
                                            label={doc.verifyLabel}
                                            variant="success"
                                            onclick={handleVerify}
                                            data-type={doc.value}
                                            disabled={doc.verifyDisabled}>
                                        </lightning-button>
                                    </template>
                                    <lightning-button
                                        label="Delete"
                                        variant="destructive"
                                        onclick={handleDelete}
                                        data-type={doc.value}
                                        disabled={doc.deleteDisabled}>
                                    </lightning-button>
                                </div>
                            </td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </lightning-card>
</template>